#!/bin/bash
# helium-wrapper
# 这是一个用于启动 Helium 浏览器的生产环境封装脚本

# 获取脚本所在的绝对路径 (通常是 /opt/helium)
HERE="$(dirname "$(readlink -f "${0}")")"

# 设置 LD_LIBRARY_PATH
# 必须将当前目录加入，因为 libEGL.so, libGLESv2.so 等都在这里
# 同时保留系统原有的 LD_LIBRARY_PATH (如果有)
export LD_LIBRARY_PATH="$HERE:$HERE/lib:$HERE/lib.target${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}}"

# 设置 CHROME_WRAPPER 变量，某些 Chromium 内部逻辑可能需要感知它是由 wrapper 启动的
export CHROME_WRAPPER="${0}"

# EXTRA: Add extra arguments
EXTRA_ARGS=()

# Detect if running under Wayland session
if [[ "${XDG_SESSION_TYPE}" == "wayland" ]] || [[ -n "${WAYLAND_DISPLAY}" ]]; then
    EXTRA_ARGS+=( "--disable-features=GlobalShortcutsPortal" )
    EXTRA_ARGS+=( "--ozone-platform=wayland" )
fi

# 启动浏览器主程序
# "$@" 确保所有命令行参数（如 URL 或 --incognito）都能正确传递
exec "$HERE/chrome" "${EXTRA_ARGS[@]}" "$@"